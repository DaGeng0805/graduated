<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8"/>
    <title></title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta name="description" content="Xenon Boostrap Admin Panel"/>
    <meta name="author" content=""/>

    <title>Xenon - Login</title>

    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Arimo:400,700,400italic">
    <link rel="stylesheet" href="../assets/css/fonts/linecons/css/linecons.css">
    <link rel="stylesheet" type="text/css" href="http://www.jq22.com/jquery/font-awesome.4.6.0.css">
    <link rel="stylesheet" type="text/css" href="http://www.jq22.com/jquery/bootstrap-3.3.4.css">
    <link href="../assets/css/bootstrapValidator.min.css" rel="stylesheet">
    <link rel="stylesheet" href="../assets/css/xenon-core.css">
    <link rel="stylesheet" href="../assets/css/xenon-forms.css">
    <link rel="stylesheet" href="../assets/css/xenon-components.css">
    <link rel="stylesheet" href="../assets/css/xenon-skins.css">
    <link rel="stylesheet" href="../assets/css/custom.css">
    <link rel="stylesheet" th:href="@{/assets/js/toastr/toastr.css}"/>
    <!--<link href="assets/css/bootstrapValidator.min.css" rel="stylesheet">-->
    <script src="http://www.jq22.com/jquery/jquery-1.10.2.js"></script>
    <script src="../assets/js/bootstrapValidator.min.js"></script>
    <style>
        .error{
            color:red;
        }
    </style>
</head>

<body class="page-body">


<div class="page-container">
    <div th:replace="~{commons/bars::sideLift}"></div>



    <div class="main-content">
        <div th:replace="~{commons/bars::sideTop}"></div>
        

        <div class="row" style="background: white;">
            <div class="row">
                <div class="col-sm-12">
                    <form role="form" class="form-horizontal"  id="bill">
                        <div class="panel panel-default">
                            <div class="panel-heading">
                                <h3 class="title">票据分发</h3>
                                <div class="panel-options">
                                    <!--<button class="btn btn-success btn-icon" id="submit">-->
                                        <!--<i class="fa-plus"></i>-->
                                        <!--<span>添&nbsp;&nbsp;&nbsp;加</span>-->
                                    <!--</button>-->


                                        <button class="btn btn-secondary btn-icon btn-icon-standalone" id="submit"
                                                type="button">
                                            <i class="fa-plus"></i>
                                            <span>添加</span>
                                        </button>

                                </div>

                            </div>

                            <div class="panel-body">
                                <div class="form-group">
                                    <label class="col-sm-2 control-label" for="beginNum">单据开始号</label>
                                    <div class="col-sm-3">
                                        <input type="text" class="form-control" id="beginNum" name="beginNum"
                                               placeholder="请输入数字" th:value="${beginNum}" readonly="readonly">
                                    </div>
                                    <label class="col-sm-2 control-label" for="endNum">单据结束号</label>
                                    <div class="col-sm-3">
                                        <input type="text" class="form-control" id="endNum" name="endNum"
                                               placeholder="请输入数字">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-2 control-label" for="receiver">领票人</label>
                                    <div class="col-sm-3">
                                        <input type="text" class="form-control" placeholder="请输入领票人名字" id="receiver"
                                               name="receiver" >
                                    </div>
                                    <label class="col-sm-2 control-label" for="receiverPhone">领票人电话</label>
                                    <div class="col-sm-3">
                                        <input type="text" class="form-control" id="receiverPhone" name="receiverPhone"
                                               placeholder="请输入数字">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-2 control-label" for="distributePerson">分发人</label>
                                    <div class="col-sm-3">
                                        <input type="text" class="form-control" id="distributePerson"
                                               name="distributePerson" placeholder="请输入分发人名字">
                                    </div>
                                    <label class="col-sm-2 control-label" for="distributePersionPhone">分发人电话</label>
                                    <div class="col-sm-3">
                                        <input type="text" class="form-control" id="distributePersionPhone"
                                               name="distributePersionPhone" placeholder="请输入数字">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-2 control-label" for="tationName">领票站点</label>
                                    <div class="col-sm-3">
                                        <input type="text" class="form-control" id="tationName" name="tationName"
                                               placeholder="请输入领票站点" autocomplete="off" >
                                        <input type="hidden" name="tationNameValue"/>
                                    </div>
                                    <label class="col-sm-2 control-label" for="receiveTime">领票时间</label>
                                    <div class="col-sm-3">
                                        <div class="input-group input-group-sm input-group-minimal">
													<span class="input-group-addon">
														<i class="fa-tag"></i>
													</span>
                                            <input type="text"  name="receiveTime" id="receiveTime"
                                                       class="form-control" />
                                            <!--<input type="text" class="form-control" id="receiveTime"-->
                                                   <!--name="receiveTime" placeholder="请输入时间">-->
                                        </div>
                                    </div>
                                </div>
                                <hr/>
                                <hr/>
                            </div>

                        </div>
                    </form>
                </div>
            </div>

        </div>
        <script>
            var xenonPalette = ['#68b828', '#7c38bc', '#0e62c7', '#fcd036', '#4fcdfc', '#00b19d', '#ff6264', '#f7aa47'];
        </script>
        <!-- Main Footer -->
        <!-- Choose between footer styles: "footer-type-1" or "footer-type-2" -->
        <!-- Add class "sticky" to  always stick the footer to the end of page (if page contents is small) -->
        <!-- Or class "fixed" to  always fix the footer to the end of page -->
        <div th:replace="~{commons/bars::sideFoot}"></div>
    </div>




</div>
<script src="../laydate/laydate.js"></script>
<script scr="@{/webjars/3.1.1/jquery.min.js}"></script>
<script src="../assets/js/bootstrap.min.js"></script>
<script src="../assets/js/TweenMax.min.js"></script>
<script src="../assets/js/resizeable.js"></script>
<script src="../assets/js/joinable.js"></script>
<script src="../assets/js/xenon-api.js"></script>
<script src="../assets/js/xenon-toggles.js"></script>
<!-- Imported scripts on this page -->
<script src="../assets/js/devexpress-web-14.1/js/globalize.min.js"></script>
<script src="../assets/js/devexpress-web-14.1/js/dx.chartjs.js"></script>
<!-- JavaScripts initializations and stuff -->
<script src="../assets/js/xenon-custom.js"></script>
<!-- Imported scripts on this page -->
<script src="../assets/js/inputmask/jquery.inputmask.bundle.js"></script>
<!--<script src="assets/js/bootstrapValidator.min.js"></script>-->
<script th:src="@{/assets/js/toastr/toastr.min.js}" type="text/javascript"></script>
<script th:src="@{/assets/js/toastr/mytoastr.js}" type="text/javascript"></script>
<script th:src="@{/assets/js/typeahead/bootstrap3-typeahead.min.js}" type="text/javascript"></script>
<script>
    //执行一个laydate实例
    laydate.render({
        elem: '#receiveTime' //指定元素
    });


</script>

<script type="text/javascript">
    $(function () {
        $('#bill').bootstrapValidator({
            message: 'This value is not valid',
            feedbackIcons: {
                valid: 'glyphicon glyphicon-ok',
                invalid: 'glyphicon glyphicon-remove',
                validating: 'glyphicon glyphicon-refresh'
            },
            fields: {
                endNum: {
                    message: '填入结束号码',
                    validators: {
                        notEmpty: {
                            message: '必填项'
                        },
                        stringLength: {
                            min: 4,
                            max: 10,
                            message: '该数字最小为四位数'
                        },
                        digits: {
                            message: '该值只能包含数字。'
                        },
                        callback :{
                            message: '结束号码需要大于等于开始号码',
                            callback: function(value,validate){
                              var beginNum = $('#beginNum').val();
                              if(Number(beginNum) > Number(value)){
                                  console.info("true");
                                  return false;
                              }else{
                                  return true;
                              }
                            }
                        }
                    }
                },
                receiver: {
                    validators: {
                        notEmpty: {
                            message: '必填项'
                        },
                        regexp: {
                            regexp: /^[\u4e00-\u9fa5]{2,4}$/,
                            message: '请输入2-4个中文'
                        }
                    }
                },
                receiverPhone: {
                    validators: {
                        notEmpty: {
                            message: '必填项'
                        },
                        regexp: {
                            regexp: /^1[3456789]\d{9}$/,
                            message: '格式有误'
                        }
                    }
                },
                distributePerson: {
                    validators: {
                        notEmpty: {
                            message: '必填项'
                        },
                        regexp: {
                            regexp: /^[\u4e00-\u9fa5]{2,4}$/,
                            message: '请输入2-4个中文'
                        }
                    }
                },
                distributePersionPhone: {
                    validators: {
                        notEmpty: {
                            message: '必填项'
                        },
                        regexp: {
                            regexp: /^1[3456789]\d{9}$/,
                            message: '格式有误'
                        }
                    }
                },
                receiveTime: {
                    validators: {
                        notEmpty: {
                            message: '请输入正确的时间'
                        },
                        date: {
                            format: 'YYYY-MM-DD',
                            message: '日期无效'
                        }
                    }
                },
                tationName: {
                    validators: {
                        notEmpty: {
                            message: '必填项'
                        }
                    }
                }
            }
        })


    });

    $('#ress').click(function () {
        $("#endNum").val("");

        $('#bill').data('bootstrapValidator',null);

//重新添加校验

        formValidator();
    })

    $('#submit').click(function () {
        var bv = $('#bill').data("bootstrapValidator");
        bv.validate();
        var time = $('#receiveTime').val();
        if(time == null || time == ""){
            toastr.error("领票时间必填");
            return false;
        }
        if(bv.isValid()){
            var s = $('#bill').serialize();
            $.ajax({
                url: '/billAdd',
                method: 'POST',
                //contentType: 'application/json',
                dataType: 'json',
                async: false,
                data:s,
                success: function (res) {
                    window.location.href='/detailBillQueryPage';
                },
                fail: function (res) {
                    toastr.fail(res.data.stateInfo);
                }
            });
            return false;
        }

    })
    $("#tationName").typeahead({
        // var query = $('#tationName').val();
        source: function (query, process) {
            return $.ajax({
                url: '/getListStationName/'+query,
                type: 'get',
                //data: {name: query},
                success: function (result) {
                    return process(result);
                },
            });
        }
    });




</script>

</body>
</html>
